<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Type Ahead ðŸ‘€</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="https://fav.farm/ðŸ”¥" />
  </head>
  <body>
    <form class="search-form">
      <input
        autocomplete="none"
        type="text"
        class="search"
        placeholder="City or State"
      />
      <ul class="suggestions">
        <li>Filter for a city</li>
        <li>or a state</li>
      </ul>
    </form>
    <script>
      const endpoint =
        "https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json";

      function eventHandler(e) {
        const list = document.querySelector("ul");
        const listItems = list.querySelectorAll("li");
        let lastListItem;

        listItems.forEach((listItem) => {
          if (
            !listItem.textContent.startsWith("Filter for") &&
            !listItem.textContent.startsWith("or a state")
          ) {
            listItem.remove();
          } else {
            if (listItem.textContent.startsWith("Filter for")) {
              lastListItem = listItem;
            }
          }
        });
        const value = this.value;

        fetch(myRequest).then((response) => {
          response.json().then((data) => {
            const filteredLocation = data.filter((location) => {
              return location.city
                .toLowerCase()
                .trim()
                .startsWith(value.toLowerCase());
            });
            filteredLocation.forEach((location) => {
              const listItem = document.createElement("li");
              listItem.textContent = location.city;
              list.insertBefore(listItem, lastListItem);
            });
          });
        });
      }
      const input = document.querySelector("input");
      input.addEventListener("input", eventHandler);

      const myRequest = new Request(endpoint);
    </script>
  </body>
</html>
